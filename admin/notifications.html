<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifications - Clinic Management</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">&#9764; ClinicCare</div>
    <button class="nav-toggle" aria-label="Toggle navigation">&#9776;</button>
    <div class="nav-links">
      <a href="dashboard.html">Dashboard</a>
      <a href="manage-doctors.html">Manage Doctors</a>
      <a href="notifications.html" class="active">Notifications</a>
      <a href="#" id="logoutBtn">Logout</a>
    </div>
  </nav>
  <div class="container">
    <h1>Notifications</h1>
    <div id="notifList" class="list-container"><p class="loading">Loading...</p></div>
  </div>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="../js/firebase-config.js"></script>
  <script src="../js/utils.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/auth-guard.js"></script>
  <script src="../js/notifications.js"></script>
  <script>
    requireAuth('admin').then(function(user) {
      onNotificationsChange(user.uid, function(notifs) {
        var container = document.getElementById('notifList');
        if (notifs.length === 0) { container.innerHTML = '<p>No notifications.</p>'; return; }
        container.innerHTML = '';
        notifs.forEach(function(n) {
          var card = createElement('div', { className: 'card' + (n.read ? '' : ' card-unread') });
          var dateStr = n.createdAt ? new Date(n.createdAt.seconds * 1000).toLocaleString() : '';
          card.innerHTML = '<p>' + escapeHtml(n.message) + '</p><p class="text-muted">' + dateStr + '</p>';
          if (!n.read) {
            card.addEventListener('click', function() { markAsRead(n.id); card.classList.remove('card-unread'); });
          }
          container.appendChild(card);
        });
      });
      document.getElementById('logoutBtn').addEventListener('click', function(e) { e.preventDefault(); logoutUser(); });
      var toggle = document.querySelector('.nav-toggle');
      var navLinks = document.querySelector('.nav-links');
      if (toggle) toggle.addEventListener('click', function() { navLinks.classList.toggle('nav-open'); });
    });
  </script>
</body>
</html>
